# Архитектурное решение по кешированию

## 1. Мотивация
Текущие проблемы кампании, которые способно решить кэширование:
- Долгая загрузка дашборда MES
- Долгий рассчёт стоимости изделия (до 30 минут)

Исходя из этого на перовм этапе кэширование предлагается внедрить для системы MES для оптимизации скорости загрузки и рассчёта стоимости изделий. 

## 2. Предлагаемое решение

Для дашбордов MES предлагается использовать серверное кэширование с использованием паттерна Read-Through с применением "прогрева кэша". Это обеспечит:
- оптимизацию скорости загрузки: сервис не будет каждый раз "ходить" в БД
- актуальность отображаемых данных (критически важно при работе с новыми заказами)

Паттерн Cache-Aside не подойдет, т.к. не может обеспечить актуальность данных (критически важно для пользователей дашборда). Паттерн Write-Through позволит обеспечить актуальность, но создат задержки при создании новых заказов. 

[Диаграма решения](./diagram.puml).

Для оптимизации скорости рассчёта стоимости изделия предлагается применить паттерн Cache-Aside. На первой итерации можно внедрить кэширование только для одинаковых изделний (в случае повторных запросов). В дальнейшем алгоритм можно приспособить для оптимизации расчёта похожих моделей. Внедрение кэширования здесь позволит:
- избежать повторных расчётов одинаковых изделий и загрузки сервиса
Т.к. рассчёт не хранится в БД, подойдёт только данный паттерн. 


Сравнительный анализ стратегий
| Стратегия          | Преимущества                           | Недостатки                      |
|--------------------|---------------------------------       |---------------------------------|
| Временная (TTL)    | - Простая реализация                   | - Риск неактуальных данных      |
|                    | - Предсказуемая нагрузка               | - Избыточная инвалидация        |
|                    | - Автоматическая очистка               | - Сложно определить TTL         |
||||
| По ключу           | - Точная инвалидация                   | - Сложная реализация            |
|                    | - Гарантия актуальности                | - Риск пропуска зависимостей    |
|                    | - Контроль согласованности             | - Доп. нагрузка на систему      |
||||
| Программная        | - Полный контроль                      | - Высокая сложность             |
|                    | - Гибкая логика                        | - Риск ошибок                   |
|                    | - Учет бизнес-логики                   | - Требует поддержки             |
||||
| На основе изменений| - Обновление данных в реальном времени | - Неэффективно при частом обновлении данных|
|                    | - Согласованность данных               |               |


В первом случае предлагается выбрать инвалидацию на основе изменений, т.к. критически важна актуальность данных о заказах.

Во втором случае предлагается использовать инвалидацию на основе измненений (в случаях, рассчёт стоимость зависит от менающихся цен на материалы и т.д.) и временную валидацию (изделие может быть уникальным и нет смысла хранить по нему расчёт, если запрос по нему не повторяется). 

